# Лабораторная работа №5. Облачные базы данных AWS: Amazon RDS и DynamoDB

**Студент:** Питропов Александр 

**Группа:** I2302

---

## 1. Описание лабораторной работы

### 1.1 Постановка задачи

Данная лабораторная работа посвящена практическому изучению сервисов облачных баз данных Amazon Web Services (AWS). Основная задача — самостоятельно развернуть инфраструктуру, включающую виртуальную частную сеть (VPC), подсети, группы безопасности, Subnet Group, реляционную базу данных Amazon RDS на MySQL, Read Replica, а также виртуальную машину EC2 для подключения к базе данных. Дополнительно необходимо выполнить CRUD-операции, протестировать работу репликации и ознакомиться с нереляционной базой данных Amazon DynamoDB.

В процессе работы студент получает навыки настройки защищённой сетевой инфраструктуры, взаимодействия с управляемыми базами данных, анализа преимуществ и ограничений разных типов хранилищ.

### 1.2 Цель работы

В ходе лабораторной работы необходимо:

* Создать и настроить сетевую инфраструктуру AWS (VPC, подсети, Security Groups).
* Развернуть реляционную базу данных Amazon RDS MySQL.
* Создать и протестировать Read Replica.
* Создать EC2-инстанс и подключиться к базе данных.
* Выполнить CRUD-операции в MySQL.
* Ознакомиться с Amazon DynamoDB и выполнить базовые операции.
* Понять сценарии эффективного использования RDS + DynamoDB вместе.

---

## 2. Практическая часть

### 2.1 Шаг 1 — Подготовка сети: VPC, подсети и группы безопасности

#### 2.1.1 Создание VPC и подсетей

Через мастер **Create VPC → VPC and more** была создана новая VPC `project-lab5-vpc` со следующими параметрами:

* CIDR-блок: `10.0.0.0/16`
* Созданы подсети:

  * публичные подсети (2 шт.) — для EC2 и NAT-gateway;
  * приватные подсети (2 шт.) — для размещения базы данных RDS.
* Включены флаги:

  * **Enable DNS resolution**
  * **Enable DNS hostnames**

Это необходимо для корректной работы RDS и EC2 в рамках VPC.

Я проверил, чтобы подсети находились в разных зонах доступности (например `eu-central-1a` и `eu-central-1b`), что повышает отказоустойчивость.

#### 2.1.2 Создание Security Groups

Созданы две группы безопасности:

---

### **web-security-group** (для EC2)

**Входящие правила:**

* HTTP (80) — от любого IP
* SSH (22) — от любого IP (для учебных целей)

**Исходящие правила:**

* Разрешён весь трафик (по умолчанию)

---

### **db-mysql-security-group** (для RDS)

**Входящие правила:**

* MySQL/Aurora 3306 — источник: *web-security-group*

Это важно: RDS доступна *только* для машин из SG веб-приложения.

---

### 2.2 Шаг 2 — Subnet Group и создание Amazon RDS

#### 2.2.1 Создание Subnet Group

Создана Subnet Group:

* Название: `project-rds-subnet-group`
* Подсети: две приватные подсети из разных зон доступности

**Контрольный вопрос:**
*Subnet Group — это набор подсетей, из которых RDS выбирает место размещения. Она позволяет указать AWS, что база должна находиться в приватных подсетях и должна иметь доступность в разных зонах.*

#### 2.2.2 Создание базы данных Amazon RDS

Параметры инстанса:

| Параметр        | Значение                        |
| --------------- | ------------------------------- |
| Engine          | MySQL 8.0.42                    |
| Instance class  | db.t3.micro                     |
| Storage         | 20GB GP3 + autoscaling до 100GB |
| Public access   | No                              |
| Security group  | db-mysql-security-group         |
| Initial DB name | project_db                      |
| Backups         | Enabled                         |

После создания дождался статуса **Available**, затем сохранил endpoint, который использовался при подключении.

---

### 2.3 Шаг 3 — Создание EC2 для подключения к базе данных

Создан EC2-инстанс Amazon Linux 2023 в **публичной подсети**, чтобы иметь доступ в интернет.

SG установлена: `web-security-group`.

В поле User Data добавлен скрипт:

```bash
#!/bin/bash
dnf update -y
dnf install -y mariadb105
```

После развертывания EC2 доступен по SSH.

---

### 2.4 Шаг 4 — Подключение к базе данных и выполнение CRUD

#### 2.4.1 Подключение по SSH к EC2

```bash
ssh -i lab5-key.pem ec2-user@<EC2_PUBLIC_IP>
```

#### 2.4.2 Подключение к MySQL (RDS)

```bash
mysql -h <RDS_ENDPOINT> -u admin -p
```

После подключения выбираем базу:

```sql
USE project_db;
```

#### 2.4.3 Создание таблиц (One-to-Many)

```sql
CREATE TABLE categories (
  id INT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(50)
);

CREATE TABLE todos (
  id INT AUTO_INCREMENT PRIMARY KEY,
  title VARCHAR(255),
  category_id INT,
  status VARCHAR(50),
  FOREIGN KEY (category_id) REFERENCES categories(id)
);
```

#### 2.4.4 Вставка данных

```sql
INSERT INTO categories (name) VALUES ('Home'), ('Work'), ('Study');

INSERT INTO todos (title, category_id, status) VALUES
('Buy milk', 1, 'pending'),
('Finish lab report', 3, 'in-progress'),
('Deploy RDS', 2, 'pending');
```

#### 2.4.5 SELECT + JOIN

```sql
SELECT t.id, t.title, c.name AS category, t.status
FROM todos t
JOIN categories c ON t.category_id = c.id;
```

---

### 2.5 Шаг 5 — Создание и тестирование Read Replica

Параметры реплики:

* `project-rds-mysql-read-replica`
* db.t3.micro
* Public access: No
* Security group: db-mysql-security-group

После создания у реплики появился собственный endpoint.

Подключение:

```bash
mysql -h <REPLICA_ENDPOINT> -u admin -p
```

#### Контрольные вопросы

**1. Какие данные видны при SELECT?**
Те же самые, что и в основной базе — реплика получает изменения из binary log.

**2. Получилось ли выполнить INSERT?**
Нет, реплика работает только в режиме чтения.

**3. Появляется ли новая запись после INSERT на Primary?**
Да, спустя пару секунд — благодаря асинхронной репликации.

**4. Для чего нужны Read Replicas?**

* Масштабирование нагрузки на чтение.
* Разгрузка основной БД.
* Использование для аналитических запросов.
* Повышение отказоустойчивости.

---

### 2.6 Шаг 6 — Подключение приложения к базе данных (вариант 6b)

Использовано PHP-приложение из лабораторной работы №4.

Были изменены параметры подключения:

```php
$host = '<RDS_ENDPOINT>';
$db   = 'project_db';
$user = 'admin';
$pass = '<password>';
```

После обновления параметров приложение успешно подключилось к RDS и корректно выполняло CRUD-операции.

Отдельные запросы чтения можно направить на Read Replica.

---

### 2.7 Шаг 7 — Работа с DynamoDB

Создана таблица **Todos**:

* Primary key: `id` (string)
* Без Sort Key (т.к. структура простая)

Затем через консоль AWS были добавлены тестовые записи.

#### Контрольные вопросы по DynamoDB

**Преимущества:**

* отсутствие схемы (гибкость);
* автоматическое масштабирование;
* низкие задержки;
* легко интегрируется через SDK.

**Недостатки:**

* отсутствие JOIN;
* необходимость заранее продумывать ключи;
* денормализация данных.

**Сценарий совместного использования RDS + DynamoDB:**

Например:

* RDS хранит пользователей, транзакции, заказы.
* DynamoDB хранит активность пользователей, историю посещений, кешируемые объекты.

Комбинация позволяет снизить нагрузку на

