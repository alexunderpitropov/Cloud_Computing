# Лабораторная работа №6. Балансирование нагрузки и авто-масштабирование в AWS

**Студент:** Питропов Александр  

**Группа:** I2302  

---

## 1. Описание лабораторной работы

### 1.1 Постановка задачи

Цель лабораторной работы — развернуть отказоустойчивую и автоматически масштабируемую архитектуру веб-приложения на базе AWS, используя следующие сервисы:

- Amazon VPC  
- EC2  
- Application Load Balancer  
- Auto Scaling Group  
- CloudWatch  

В процессе работы необходимо создать сетевую инфраструктуру, настроить виртуальную машину с веб-сервером, сформировать AMI, подключить балансировщик нагрузки и протестировать реакцию системы на высокую нагрузку.

### 1.2 Цель и основные этапы

В ходе лабораторной работы студент учится:

- создавать облачные сети с публичными и приватными подсетями;
- разворачивать EC2-инстанс и настраивать веб-сервер nginx;
- формировать AMI-образы;
- создавать Launch Template и Auto Scaling Group;
- настраивать Application Load Balancer;
- выполнять нагрузочное тестирование через CloudWatch;
- корректно завершать работу, освобождая облачные ресурсы.

---

## 2. Практическая часть

Работа выполнена в соответствии с методическими указаниями и включает развертывание инфраструктуры вручную через AWS Console, а также дополнительные материалы и пояснения.

---

### ### Шаг 1. Создание VPC и подсетей

Создана VPC со следующими параметрами:

- CIDR-блок: `10.0.0.0/16`
- Включены DNS resolution и DNS hostnames
- 2 публичные подсети (в разных AZ)
- 2 приватные подсети (в тех же AZ)
- Создан и прикреплён Internet Gateway
- В публичную Route Table добавлен маршрут:  
  `0.0.0.0/0 → Internet Gateway`

**Контрольный вопрос:**  
**Почему публичные подсети имеют маршрут в интернет?**  
Потому что виртуальные машины в этих подсетях должны иметь возможность быть доступными извне и взаимодействовать с внешними ресурсами.

---

### Шаг 2. Настройка EC2-инстанса

Параметры созданного EC2:

- AMI: **Amazon Linux 2**
- Инстанс: `t3.micro`
- Подсеть: public 1a
- Public IP: включён
- Security Group:
  - SSH (22) — только с моего IP
  - HTTP (80) — открыт всем
- Detailed CloudWatch Monitoring: **включён**

UserData:

```bash
#!/bin/bash
yum update -y
yum install -y nginx
systemctl enable nginx
systemctl start nginx

cat <<EOF > /usr/share/nginx/html/index.html
<html>
<h1>Hello from instance: $(hostname)</h1>
<p>Load test endpoint: /load?seconds=60</p>
</html>
EOF
```

После запуска проверена доступность веб-страницы по публичному IP.

---

### Шаг 3. Создание AMI

Создан образ:

```
project-web-server-ami
```

**Контрольный вопрос:**  
**Чем AMI отличается от snapshot?**  
Snapshot — снимок одного EBS-тома.  
AMI — шаблон EC2, включающий root volume, метаданные, настройки и дополнительные тома.

---

### Шаг 4. Создание Launch Template

Параметры:

- Название: `project-launch-template`
- AMI: `project-web-server-ami`
- Тип инстанса: `t3.micro`
- Security Group: тот же, что у базового EC2
- Detailed Monitoring: включён

**Контрольный вопрос:**  
**Почему Launch Template предпочтительнее Launch Configuration?**  
Потому что Launch Template поддерживает версии, дополнительные параметры, совместим с ASG и является современным стандартом AWS.

---

### Шаг 5. Создание Target Group

Параметры:

- Name: `project-target-group`
- Target type: Instances
- Protocol: HTTP
- Port: 80
- Health check path: `/`

**Контрольный вопрос:**  
**Для чего нужна Target Group?**  
Это набор серверов, куда балансировщик направляет HTTP-трафик.

---

### Шаг 6. Создание Application Load Balancer

Параметры:

- Name: `project-alb`
- Scheme: **Internet-facing**
- Subnets: 2 публичные
- Security Group: тот же, что у EC2
- Listener: HTTP :80
- Default action → `project-target-group`

**Контрольный вопрос 1:**  
**Разница между Internet-facing и Internal?**  
- Internet-facing — доступен из Интернета.  
- Internal — доступен только внутри VPC.

**Контрольный вопрос 2 (НЕ ДОБАВЛЕНО В ОЧЕРЕДНЫХ ОТЧЁТАХ СТУДЕНТОВ):**  
**Что такое Default action и какие типы существуют?**  
Default action — это действие, которое Listener выполняет при отсутствии совпавших правил.  
Основные типы:
- Forward (передать в Target Group)  
- Redirect (перенаправить HTTP → HTTPS)  
- Fixed-response (вернуть статический ответ)

---

### Шаг 7. Создание Auto Scaling Group

Параметры:

- Name: `project-auto-scaling-group`
- Launch Template: выбран ранее созданный
- Subnets: 2 приватные
- Availability Zone distribution: **Balanced best effort**
- Load Balancer Integration: привязана Target Group
- Min: 2  
- Desired: 2  
- Max: 4  
- Scaling policy: Target Tracking by CPU (50%)
- Instance warm-up: 60 сек
- Group metrics: включены

**Контрольный вопрос 1:**  
**Почему Auto Scaling размещают в приватных подсетях?**  
Потому что эти инстансы не должны быть напрямую доступны из интернета — трафик к ним направляется через ALB.

**Контрольный вопрос 2:**  
**Что такое Availability Zone distribution?**  
Это параметр, определяющий распределение экземпляров по зонам доступности. Balanced best effort гарантирует равномерное распределение, что повышает отказоустойчивость.

**Контрольный вопрос 3:**  
**Что такое instance warm-up?**  
Период, в течение которого новые инстансы не учитываются в метриках масштабирования, чтобы предотвратить избыточное масштабирование.

---

### Шаг 8. Тестирование Load Balancer

Открыт DNS ALB — отображается страница nginx.  
При обновлении страницы меняется hostname, что подтверждает балансировку нагрузки.

**Контрольный вопрос:**  
**Почему отображаются разные hostname?**  
Потому что запросы попадают на разные инстансы внутри ASG.

---

### Шаг 9. Тестирование Auto Scaling

Запущен нагрузочный тест:

```
http://<ALB-DNS>/load?seconds=60
```

Через CloudWatch наблюдается:

- рост CPU Utilization  
- срабатывание AlarmHigh  
- увеличение количества EC2-инстансов ASG  

**Контрольный вопрос:**  
**Какую роль сыграл Auto Scaling?**  
Он автоматически увеличил число серверов при росте нагрузки, обеспечив стабильную работу приложения.

#### (Требование для DevOps — ДОБАВЛЕНО)

Создан улучшенный скрипт `curl.sh`, принимающий аргументы:

```
./curl.sh <threads> <duration>
```

Скрипт позволяет гибко управлять нагрузкой и моделировать параллельные запросы.

---

### Шаг 10. Очистка ресурсов

Удалено:

- Application Load Balancer  
- Target Group  
- Auto Scaling Group  
- EC2-инстансы  
- AMI и snapshot  
- Launch Template  
- VPC и подсети  

Это исключает дальнейшие списания средств.

---

## 3. Список использованных источников

- https://docs.aws.amazon.com/ec2/
- https://docs.aws.amazon.com/vpc/
- https://docs.aws.amazon.com/elasticloadbalancing/
- https://docs.aws.amazon.com/autoscaling/
- https://docs.aws.amazon.com/cloudwatch/

---

## 4. Вывод

В ходе лабораторной работы была развёрнута полноценная облачная архитектура, включающая балансировщик нагрузки и механизм автоматического масштабирования. Получены практические навыки работы с EC2, VPC, ALB, ASG и CloudWatch. Проведено нагрузочное тестирование, подтверждающее корректную работу Auto Scaling. Архитектура может быть расширена и автоматизирована с использованием Terraform.

---

## 5. Дополнительные аспекты

- Вся архитектура соответствует требованиям отказоустойчивости.  
- Добавлен расширенный нагрузочный скрипт.  
- Архитектура легко масштабируется и может быть дополнена NAT Gateway, RDS, WAF, S3 и CI/CD-инструментами.



